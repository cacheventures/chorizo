#!/usr/bin/env ruby

require 'chorizo'
require 'slop'
require 'colorize'

opts = Slop.parse(help: true) do
  banner 'Usage: chorizo [options]'

  on :t, :target, 'target host. one of "cloud66" or "heroku"', argument: true
  on :e, :environment, 'environment. e.x. "staging"', argument: true
  on :a, :app, 'app. (for heroku only)', argument: :optional
end

unless opts[:environment]
  STDERR.puts "please specify an environment".red
  puts opts
  exit 1
end

if opts[:target] == 'heroku' && !opts[:app]
  STDERR.puts "please specify an app for heroku".red
  puts opts
  exit 1
end

Chorizo.new.run(
  opts[:environment], opts, target: opts[:target], app: opts[:app]
)
